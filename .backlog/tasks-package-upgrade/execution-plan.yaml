# Execution Plan - Package Upgrade Project
# Auto-generated by Task Manager v3.1
# Date: 2025-11-16

project:
  name: "Raggy Package Upgrade"
  description: "Systematic upgrade of all dependencies from legacy versions to latest (Nov 2025)"
  total_estimated_hours: "23.5-47"
  risk_level: "MEDIUM-HIGH"

workflow:
  mode: "INCREMENTAL"
  strategy: "Generate tasks for 1-2 phases at a time to maintain focus and adapt to issues"
  current_phase: 3
  phases_generated: 4
  phases_total: 6

phases:
  - number: 0
    name: "Pre-Upgrade Foundation"
    status: "NOT_STARTED"
    task_file: "00-pre-upgrade-foundation.yaml"
    estimated_hours: "1-2"
    priority: "CRITICAL"
    blocking: true
    description: "Create backups, baselines, and safety infrastructure before upgrades"
    tasks: 7
    key_deliverables:
      - "Git feature branch created"
      - "Baseline files for tests, linting, packages"
      - "ChromaDB database backup"
      - "Rollback documentation"
    blocking_criteria:
      - "PRE-006: Python version must be 3.10+ to proceed"

  - number: 1
    name: "Python Version Upgrade"
    status: "NOT_STARTED"
    task_file: "01-python-version-upgrade.yaml"
    estimated_hours: "1-2"
    priority: "CRITICAL"
    blocking: true
    prerequisite_phase: 0
    description: "Update Python version requirement from 3.8 to 3.10 in all configs"
    tasks: 11
    key_deliverables:
      - "pyproject.toml: requires-python >=3.10"
      - "ruff target-version: py310"
      - "mypy python_version: 3.10"
      - "Python 3.8/3.9 classifiers removed"
      - "CHANGELOG updated with breaking change"
    blocking_criteria:
      - "PY-011: Changes must be committed before proceeding to Phase 2"

  - number: 2
    name: "Core Dependencies Upgrade"
    status: "COMPLETED"
    task_file: "02-core-dependencies-upgrade.yaml"
    estimated_hours: "8-16"
    priority: "HIGH"
    blocking: true
    prerequisite_phase: 1
    description: "Upgrade core runtime dependencies (ChromaDB, sentence-transformers, pypdf, python-docx)"
    tasks: 15
    completed_at: "2025-11-16T16:17:27Z"
    key_deliverables:
      - "PyPDF2 → pypdf 6.2.0 migration"
      - "ChromaDB 0.4.x → 1.3.3 upgrade (with database migration)"
      - "sentence-transformers 2.2.x → 5.1.2 upgrade"
      - "python-docx 1.0.x → 1.2.0 upgrade"
      - "All core tests passing"
      - "CHANGELOG updated"

  - number: 3
    name: "Optional Dependencies Upgrade"
    status: "READY"
    task_file: "03-optional-dependencies-upgrade.yaml"
    estimated_hours: "2-4"
    priority: "MEDIUM"
    blocking: false
    prerequisite_phase: 2
    description: "Upgrade optional cloud integrations (Pinecone, Supabase, OpenAI, PyYAML, python-magic)"
    tasks: 11
    generated_at: "2025-11-16T16:45:00Z"
    key_deliverables:
      - "PyYAML version verification (already 6.0+)"
      - "python-magic version constraint added"
      - "pinecone-client upgraded to latest"
      - "supabase upgraded to latest"
      - "openai upgraded to latest"
      - "All optional extras tested"
      - "CHANGELOG updated"

  - number: 4
    name: "Dev Dependencies Upgrade"
    status: "NOT_GENERATED"
    estimated_hours: "4-8"
    priority: "HIGH"
    blocking: true
    prerequisite_phase: 3
    description: "Upgrade testing and code quality tools (pytest, ruff, mypy, bandit, safety)"
    estimated_tasks: "10-15"
    key_challenges:
      - "pytest 7 → 9 (breaking changes)"
      - "pytest-cov 4 → 6 (breaking changes)"
      - "ruff 0.1 → 0.9 (breaking changes)"
      - "safety 2.3 → 3.2 (breaking changes)"
    generation_trigger: "After Phase 3 completion, user requests: 'Continue to Phase 4'"

  - number: 5
    name: "Build System Upgrade"
    status: "NOT_GENERATED"
    estimated_hours: "0.5-1"
    priority: "LOW"
    blocking: false
    prerequisite_phase: 4
    description: "Upgrade hatchling build backend and finalize package metadata"
    estimated_tasks: "3-5"
    generation_trigger: "After Phase 4 completion, user requests: 'Continue to Phase 5'"

execution_instructions:
  step_1:
    action: "Execute Phase 0 tasks"
    file: "00-pre-upgrade-foundation.yaml"
    command: "Work through tasks PRE-001 through PRE-007"
    notes:
      - "Create feature branch first (PRE-001)"
      - "CRITICAL: Verify Python >=3.10 with PRE-006"
      - "If Python < 3.10, user MUST upgrade Python before continuing"

  step_2:
    action: "Execute Phase 1 tasks"
    file: "01-python-version-upgrade.yaml"
    command: "Work through tasks PY-001 through PY-011"
    notes:
      - "Update pyproject.toml Python constraints"
      - "Commit changes (PY-011) before proceeding"

  step_3:
    action: "Request Phase 2 tasks"
    command: "Tell Claude: 'Continue to Phase 2 (Core Dependencies)'"
    notes:
      - "Phase 2 tasks will be generated on-demand"
      - "This prevents overwhelming task list"
      - "Allows adaptation based on Phase 0-1 results"

  step_4:
    action: "Continue through remaining phases"
    pattern: "Complete current phase → Request next phase → Execute tasks → Repeat"
    notes:
      - "Each phase builds on previous phases"
      - "Blockers must be resolved before proceeding"
      - "Rollback procedures documented in each phase file"

safety_measures:
  - "Feature branch isolates upgrade work"
  - "Baseline files enable before/after comparison"
  - "ChromaDB backup enables rollback of irreversible migration"
  - "Incremental commits allow granular rollback"
  - "Rollback documentation in ROLLBACK.md"
  - "Each phase has rollback_procedure section"

quality_gates:
  after_each_phase:
    - "Tests pass (or failures documented with comparison to baseline)"
    - "Linting passes (or new errors documented)"
    - "Type checking passes (or new errors documented)"
    - "Changes committed to feature branch"
    - "CHANGELOG updated"

final_validation:
  description: "After all phases complete"
  steps:
    - "Run full test suite: pytest --verbose --cov=raggy --cov-fail-under=85"
    - "Run code quality: ruff check . && mypy raggy.py"
    - "Run security scan: bandit -r . -ll"
    - "Compare with baselines to ensure no regressions"
    - "Create pull request for review"
    - "Document upgrade process in docs/artifacts/UPGRADE_COMPLETED.md"

next_steps:
  immediate: "Begin Phase 0: Pre-Upgrade Foundation"
  command: "Start with task PRE-001 (create git branch)"
  after_phase_1: "Request Phase 2 tasks: 'Continue to Phase 2'"
